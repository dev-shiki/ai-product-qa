# Code Optimization

**File**: `./app/api/products.py`  
**Time**: 08:58:26  
**Type**: code_optimization

## Improvement

**Optimization:**

Replace the redundant `try...except` blocks with a reusable exception handler.

**Improvement with Explanation:**

Instead of repeating the `try...except` block in each route, create a decorator or a reusable function to handle exceptions centrally. This reduces code duplication and improves maintainability.  Here's how you could implement a decorator:

```python
from fastapi import APIRouter, HTTPException
from app.services.product_data_service import ProductDataService
from app.models.product import ProductResponse
from typing import List, Optional
from functools import wraps

router = APIRouter()
product_service = ProductDataService()

def handle_exceptions(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        try:
            return await func(*args, **kwargs)
        except Exception as e:
            raise HTTPException(status_code=500, detail=str(e))
    return wrapper


@router.get("/", response_model=List[ProductResponse])
@handle_exceptions
async def get_products(
    limit: Optional[int] = 20,
    category: Optional[str] = None,
    search: Optional[str] = None
):
    """Get products from local data source"""
    products = await product_service.get_products(
        limit=limit,
        category=category,
        search=search
    )
    return products

@router.get("/categories")
@handle_exceptions
async def get_categories():
    """Get available product categories"""
    categories = await product_service.get_categories()
    return {"categories": categories}

@router.get("/search")
@handle_exceptions
async def search_products(query: str, limit: Optional[int] = 10):
    """Search products by query"""
    products = await product_service.search_products(query, limit)
    return {"products": products, "query": query, "source": "local"}

@router.get("/top-rated")
@handle_exceptions
async def get_top_rated_products(limit: Optional[int] = 10):
    """Get top rated products"""
    products = await product_service.get_top_rated_products(limit)
    return {"products": products, "source": "local"}
```

**Why this is an optimization:**

*   **DRY (Don't Repeat Yourself):**  Reduces code duplication by encapsulating the exception handling logic in a single place.
*   **Maintainability:**  If you need to change the exception handling (e.g., add logging), you only need to modify it in one place instead of multiple routes.
*   **Readability:** The route handlers become cleaner and easier to understand, focusing on the core business logic.

While this doesn't improve the *speed* of the code directly, it significantly improves its structure and maintainability, which are crucial aspects of code quality and can indirectly contribute to efficiency in the long run.

---
*Generated by Smart AI Bot*
