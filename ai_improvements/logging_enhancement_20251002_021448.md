# Logging Enhancement

**File**: `./app/api/queries.py`  
**Time**: 02:14:48  
**Type**: logging_enhancement

## Improvement

```python
import logging
from typing import List, Dict
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
from app.services.product_data_service import ProductDataService
from app.services.ai_service import AIService
import re

# Setup logging
logger = logging.getLogger(__name__)

router = APIRouter()
product_service = ProductDataService()
ai_service = AIService()

class QueryRequest(BaseModel):
    question: str

class QueryResponse(BaseModel):
    answer: str
    products: List[dict]
    question: str
    note: str

@router.post("/ask", response_model=QueryResponse)
async def ask_question(request: QueryRequest):
    """Ask a question about products and get recommendations"""
    logger.info(f"Received question: {request.question}")  # Log the incoming question
    try:
        # Get AI response
        logger.info("Calling AI service to get response.")
        ai_response = await ai_service.get_response(request.question)
        logger.info(f"AI service returned: {ai_response}")  # Log the AI response

        # Get relevant products and fallback message
        # Ekstrak kategori dan max_price dari pertanyaan (sederhana)
        category = None
        max_price = None

        # Deteksi kategori dengan lebih lengkap
        question_lower = request.question.lower()
        category_mapping = {
            'laptop': ['laptop', 'notebook', 'komputer'],
            'smartphone': ['smartphone', 'hp', 'handphone', 'phone', 'telepon', 'ponsel'],
            'tablet': ['tablet', 'ipad'],
            'headphone': ['headphone', 'earphone', 'headset', 'audio'],
            'kamera': ['kamera', 'camera', 'fotografi'],
            'audio': ['audio', 'speaker', 'sound'],
            'tv': ['tv', 'televisi'],
            'drone': ['drone', 'quadcopter'],
            'jam': ['jam', 'watch', 'smartwatch']
        }
        # ... (rest of the function)
```

Key improvements and explanations:

* **Clear Logging Statements:**  The logging statements are now informative. They explicitly state what is being logged (e.g., "Received question", "AI service returned").  This makes debugging *much* easier.
* **Log Levels:**  `logger.info()` is used for general information.  `logger.debug()` could be used for more verbose information that you only need occasionally during development (like the extracted category or max price before querying the database).  `logger.error()` or `logger.exception()` would be crucial inside `except` blocks to log errors.  I did not add error logging as it wasn't present in the original and would depend on how you want to handle exceptions in the rest of the function.
* **Contextual Information:** The log messages include relevant data (the question itself, the AI response).  This is essential for understanding the flow of execution and identifying issues.
* **Placement:** Logging is added *before* and *after* the AI service call. This helps pinpoint if the problem is in sending the request or receiving the response.
* **No Redundant Logging:** Avoid logging things that are already trivially clear from the code. Focus on key events and data.
* **Avoid Logging Secrets/PII:** Be extremely careful never to log sensitive data (passwords, API keys, personally identifiable information).
* **f-strings:** Uses f-strings for easy and readable string formatting.
* **Consistent Style:** Keeps the formatting consistent with the original code.

How to Use:

1.  **Configure Logging:**  Make sure your `logging` module is properly configured.  This is often done in your main application file (e.g., `main.py`).  A basic configuration looks like this:

    ```python
    import logging

    logging.basicConfig(level=logging.INFO,  # Or logging.DEBUG
                        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    ```

    You can customize the logging level (INFO, DEBUG, WARNING, ERROR, CRITICAL) and the log message format.  You can also configure logging to write to a file instead of the console.
2.  **Run Your App:**  Start your FastAPI application.
3.  **Check the Logs:**  The log messages will appear in your console (or in the log file, if you configured it to write to a file).

With these additions, you'll have much better visibility into how your `ask_question` function is working and be able to diagnose problems quickly. Remember to add proper exception handling and logging within those `except` blocks as well, which I omitted here for brevity.

---
*Generated by Smart AI Bot*
