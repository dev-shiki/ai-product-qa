# Error Handling Improvement

**File**: `./app/utils/config.py`  
**Time**: 01:57:17  
**Type**: error_handling_improvement

## Improvement

```python
from pydantic_settings import BaseSettings
from functools import lru_cache
import logging
import os

# Setup logging
logger = logging.getLogger(__name__)

class Settings(BaseSettings):
    # API Configuration
    GOOGLE_API_KEY: str
    API_HOST: str = "localhost"
    API_PORT: int = 8000
    FRONTEND_HOST: str = "localhost"
    FRONTEND_PORT: int = 8501
    DEBUG: bool = True

    class Config:
        env_file = ".env"

    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        if not self.GOOGLE_API_KEY or self.GOOGLE_API_KEY == "your-google-api-key-here":
            logger.error("GOOGLE_API_KEY is not set or is using default value")
            if os.getenv("GOOGLE_API_KEY") is None:
                logger.error("GOOGLE_API_KEY environment variable is also not set.")
                raise ValueError("GOOGLE_API_KEY must be set in .env file or as an environment variable.")
            else:
                 raise ValueError("GOOGLE_API_KEY in .env is the default value, but an environment variable is set.  Please update the .env file.")


@lru_cache()
def get_settings():
    return Settings()

settings = get_settings()
```

Key improvements in error handling:

* **More informative error message:**  The original code only raised a `ValueError` if `GOOGLE_API_KEY` was missing or had the default value.  The improved code first checks if the environment variable `GOOGLE_API_KEY` is set.  If *neither* the `.env` nor the environment variable is set, it provides a more specific and helpful error message to the user indicating that the key is missing from both locations. This clarifies where the problem lies.
* **Handles case where environment variable is set but .env is not:** Now it checks if only the GOOGLE_API_KEY environment variable is set, but the value in the `.env` file is still the default. It then informs the user to please update the `.env` file.
* **Robustness:** By checking for the presence of the environment variable, the application becomes more robust.  It allows users to configure the API key either through the `.env` file or directly as an environment variable, which is often preferred in production deployments.
* **Logging:** The logging is enhanced. The error message includes additional context, so developers can quickly understand the cause of the error.

This improved version gives the user much clearer instructions on how to resolve the missing API key issue.  It also provides better support for different deployment environments.

---
*Generated by Smart AI Bot*
