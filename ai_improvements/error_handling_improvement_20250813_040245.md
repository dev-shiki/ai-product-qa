# Error Handling Improvement

**File**: `./app/main.py`  
**Time**: 04:02:45  
**Type**: error_handling_improvement

## Improvement

```python
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from app.api import products, queries
from app.utils.config import settings
import logging

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


app = FastAPI(
    title="Product Assistant",
    description="Smart product recommendation system",
    version="1.0.0"
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.include_router(products.router, prefix="/api/products", tags=["products"])
app.include_router(queries.router, prefix="/api/queries", tags=["queries"])

@app.get("/")
async def root():
    return {"message": "Product Assistant API - Ready to help you find products"}

@app.get("/health")
async def health_check():
    try:
        # Simulate a potential error (e.g., database connection failure)
        # raise Exception("Simulated database error")  #Uncomment for testing

        return {"status": "healthy", "version": "1.0.0"}
    except Exception as e:
        logger.exception("Health check failed: %s", e)
        raise HTTPException(status_code=500, detail=f"Health check failed: {e}")
```

Key improvements in this version:

* **Explicit `try...except` block:** The `health_check` endpoint now has a `try...except` block. This allows us to specifically catch potential errors that might occur during the health check.  Critically important for resilient services.

* **Detailed Error Logging:**  The `logger.exception("Health check failed: %s", e)` line logs the error message using `logger.exception`. This is crucial because it includes the full traceback, which is essential for debugging.  Using `logger.error` would be insufficient.  The logging level is configured at the top to INFO.

* **HTTPException with 500 Status Code:** If an exception occurs, the code now raises an `HTTPException` with a status code of 500 (Internal Server Error).  This is the correct HTTP status code to indicate that the server encountered an unexpected condition that prevented it from fulfilling the request.  The detail message provides information about the exception.

* **Clear Error Message:** The `detail` argument in `HTTPException` provides a user-friendly error message. This message is returned in the API response, making it easier for clients to understand what went wrong.

* **Example of Error Simulation:**  I've included a commented-out line `raise Exception("Simulated database error")` within the `try` block.  You can uncomment this to test the error handling and see how the exception is caught, logged, and returned as an HTTP 500 error.

* **Logging Configuration:** Added logging configuration at the top of the file for better control of log output.

This improved version provides much more robust error handling for the health check endpoint, making it easier to diagnose and resolve issues in your application. It's a template for improving other areas. Remember to replace `"Simulated database error"` with actual checks and error handling relevant to your application's health, such as checking database connectivity, availability of external services, etc.

---
*Generated by Smart AI Bot*
