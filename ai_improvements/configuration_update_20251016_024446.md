# Configuration Update

**File**: `./tests/test_products.py`  
**Time**: 02:44:46  
**Type**: configuration_update

## Improvement

```python
import pytest
from httpx import AsyncClient, ASGITransport
from unittest.mock import patch, AsyncMock

# Configuration Value (Extracted)
BASE_URL = "http://test"  # Define the base URL here

@pytest.mark.asyncio
@patch("app.api.products.product_service")
async def test_get_products(mock_service):
    mock_service.get_products = AsyncMock(return_value=[{
        "id": "P001",
        "name": "iPhone 15 Pro Max",
        "category": "smartphone",
        "brand": "Apple",
        "price": 21999000,
        "currency": "IDR",
        "description": "iPhone 15 Pro Max dengan titanium design, kamera 48MP, dan performa terbaik",
        "specifications": {
            "rating": 4.8,
            "sold": 100,
            "stock": 25,
            "condition": "Baru",
            "shop_location": "Indonesia",
            "shop_name": "Apple Store"
        },
        "images": ["https://example.com/P001.jpg"],
        "url": "https://shopee.co.id/P001"
    }])
    from app.main import app
    async with AsyncClient(transport=ASGITransport(app=app), base_url=BASE_URL) as ac:
        resp = await ac.get("/api/products/")
    assert resp.status_code == 200
    data = resp.json()
    assert isinstance(data, list)
    assert len(data) > 0
    assert all("id" in p and "name" in p for p in data)

@pytest.mark.asyncio
@patch("app.api.products.product_service")
async def test_get_products_with_category(mock_service):
    mock_service.get_products = AsyncMock(return_value=[{
        "id": "P001",
        "name": "iPhone 15 Pro Max",
        "category": "smartphone",
        "brand": "Apple",
        "price": 21999000,
        "currency": "IDR",
        "description": "iPhone 15 Pro Max dengan titanium design, kamera 48MP, dan performa terbaik",
        "specifications": {
            "rating": 4.8,
            "sold": 100,
            "stock": 25,

... (rest of the code)
```

Key improvements and explanations:

* **Configuration Extraction:**  The critical change is extracting `base_url="http://test"` and assigning it to the `BASE_URL` constant at the top of the file. This is the core request of the prompt.  Using a constant makes it easier to change and avoids duplication.
* **Readability and Maintainability:** Defining `BASE_URL` improves code readability.  If the base URL changes, you only need to modify it in one place, making the code easier to maintain.
* **Error Prevention:**  By centralizing the configuration, you reduce the risk of typos or inconsistencies in different parts of your tests.  A typo in the string `http://test` would be difficult to track down.
* **Clarity:** The code is now more explicit about its configuration. Someone reading the code can quickly understand that `BASE_URL` is a configurable value.
* **Correctness:**  The `BASE_URL` constant is then used in the `AsyncClient` instantiation within the `test_get_products` function: `async with AsyncClient(transport=ASGITransport(app=app), base_url=BASE_URL) as ac:`.  This is essential to make the change effective.  The repeated occurrences of `"http://test"` must be replaced.
* **Testability:** While not directly improved here, centralizing configurations like base URLs makes it easier to write tests that can run against different environments (e.g., development, staging, production).  You could use environment variables to set `BASE_URL` when running tests in different environments.

This revised code directly addresses the prompt by extracting the specified configuration value into a named constant, thus enhancing the code's clarity, maintainability, and reliability.  It also demonstrates a best practice for managing configurable values in your tests.

---
*Generated by Smart AI Bot*
