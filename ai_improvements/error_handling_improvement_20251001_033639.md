# Error Handling Improvement

**File**: `./app/services/ai_service.py`  
**Time**: 03:36:39  
**Type**: error_handling_improvement

## Improvement

```python
import logging
from google import genai
from app.utils.config import get_settings
from app.services.product_data_service import ProductDataService

# Setup logging
logger = logging.getLogger(__name__)

class AIService:
    def __init__(self):
        """Initialize AI service with Google AI API"""
        try:
            settings = get_settings()
            # Use the new Google AI client
            self.client = genai.Client(api_key=settings.GOOGLE_API_KEY)
            self.product_service = ProductDataService()
            logger.info("Successfully initialized AI service with Google AI client")
        except Exception as e:
            logger.exception("Error initializing AI service")  # Log the full stack trace
            raise  # Re-raise to signal that the service failed to initialize

    async def get_response(self, question: str) -> str:
        """Get AI response with product context and fallback message"""
        try:
            logger.info(f"Getting AI response for question: {question}")

            # Ekstrak kategori dan max_price dari pertanyaan (sederhana)
            import re
            category = None
            max_price = None

            # Deteksi kategori dengan lebih lengkap (sama dengan API endpoint)
            question_lower = question.lower()
            category_mapping = {
                'laptop': ['laptop', 'notebook', 'komputer'],
                'smartphone': ['smartphone', 'hp', 'handphone', 'phone', 'telepon', 'ponsel'],
                'tablet': ['tablet', 'ipad'],
                'headphone': ['headphone', 'earphone', 'headset', 'audio'],
                'kamera': ['kamera', 'camera', 'fotografi'],
                'audio': ['audio', 'speaker', 'sound'],
                'tv': ['tv', 'televisi'],
                'drone': ['drone', 'quadcopter'],
                'jam': ['jam', 'watch', 'smartwatch']
            }

            for cat, keywords in category_mapping.items():
                if any(keyword in question_lower for keyword in keywords):
                    category = cat
                    break

... (truncated for analysis)
```

Key improvements in error handling:

* **`logger.exception("Error initializing AI service")`**:  Replaced `logger.error(f"Error initializing AI service: {str(e)}")` with `logger.exception("Error initializing AI service")`.  `logger.exception` automatically logs the exception message *and* the stack trace.  This is *crucial* for debugging.  Without the stack trace, you only know *that* an error happened, but not *where* or *why* in detail. The stack trace tells you the exact line of code that caused the error and the chain of function calls that led to it.  It drastically speeds up debugging.
* **`raise`**:  The `raise` statement is correctly maintained to re-raise the exception.  This is important because if the `AIService` fails to initialize, the application probably shouldn't continue. Re-raising the exception allows the calling code to handle the initialization failure gracefully (e.g., retry, terminate, or use a fallback).

Why these changes are important:

* **Detailed Debugging:** The stack trace provided by `logger.exception` is invaluable during development and troubleshooting.  It allows you to quickly pinpoint the source of errors.
* **Proper Error Propagation:** Re-raising the exception ensures that the error is not silently ignored. The calling code must handle the initialization failure appropriately.  This makes the application more robust.

This improved error handling makes the code much easier to debug and maintain, leading to a more reliable application.  It follows best practices for logging exceptions.

---
*Generated by Smart AI Bot*
