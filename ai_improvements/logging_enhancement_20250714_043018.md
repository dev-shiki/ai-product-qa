# Logging Enhancement

**File**: `./app/api/products.py`  
**Time**: 04:30:18  
**Type**: logging_enhancement

## Improvement

```python
from fastapi import APIRouter, HTTPException
from app.services.product_data_service import ProductDataService
from app.models.product import ProductResponse
from typing import List, Optional
import logging

router = APIRouter()
product_service = ProductDataService()

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


@router.get("/", response_model=List[ProductResponse])
async def get_products(
    limit: Optional[int] = 20,
    category: Optional[str] = None,
    search: Optional[str] = None
):
    """Get products from local data source"""
    logger.info(f"Getting products with limit={limit}, category={category}, search={search}")
    try:
        products = await product_service.get_products(
            limit=limit,
            category=category,
            search=search
        )
        logger.info(f"Successfully retrieved {len(products)} products.")
        return products
    except Exception as e:
        logger.exception("Error while getting products:")
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/categories")
async def get_categories():
    """Get available product categories"""
    try:
        categories = await product_service.get_categories()
        return {"categories": categories}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/search")
async def search_products(query: str, limit: Optional[int] = 10):
    """Search products by query"""
    try:
        products = await product_service.search_products(query, limit)
        return {"products": products, "query": query, "source": "local"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/top-rated")
async def get_top_rated_products(limit: Optional[int] = 10):
    """Get top rated products"""
    try:
        products = await product_service.get_top_rated_products(limit)
        return {"products": products, "source": "local"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

Key improvements and explanations:

* **Import `logging`:**  Crucially, we need to import the `logging` module.
* **Configure Logging:**  Adds basic configuration:  `logging.basicConfig(level=logging.INFO)`.  This sets up a logger that outputs to the console at the INFO level and above (WARNING, ERROR, CRITICAL).  You can customize this further with file output, different levels, and custom formatters.
* **Create a Logger Instance:**  `logger = logging.getLogger(__name__)` creates a logger specific to the module.  Using `__name__` makes it easy to trace log messages back to their origin.
* **Logging at Different Levels:**
    * **`logger.info(...)`:** Logs general information about the request and successful retrieval.
    * **`logger.exception(...)`:**  This is the *most important* change.  When an exception occurs, `logger.exception()` logs the exception message *and* the traceback.  This gives you the context you need to diagnose the problem.  It's used *inside* the `except` block.  This is much better than just logging `str(e)`.
* **Informative Messages:**  The log messages include the values of the input parameters (`limit`, `category`, `search`) to make debugging easier.  The success message includes the number of products returned.
* **Clear Error Handling:** The `try...except` block now catches *any* exception that might occur during the product retrieval process.  This is important to prevent the API from crashing and to provide a useful error message to the client.  The `HTTPException` now includes the string representation of the exception (`str(e)`).

This revised response provides a complete and robust solution for adding logging to the `get_products` function, making it significantly easier to debug and monitor the API.  It also emphasizes best practices for exception handling and logging in Python. Remember to install the logging module if you haven't already.  However, it's a built-in module, so you shouldn't need to install it.

---
*Generated by Smart AI Bot*
