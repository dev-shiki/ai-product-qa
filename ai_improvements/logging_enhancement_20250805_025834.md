# Logging Enhancement

**File**: `./frontend/streamlit_app.py`  
**Time**: 02:58:34  
**Type**: logging_enhancement

## Improvement

```python
import streamlit as st
import requests
import json
from datetime import datetime
import time
import logging

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')


# Configuration
API_BASE_URL = "http://localhost:8000"

def fetch_products(query: str, category: str = None, min_price: float = None, max_price: float = None, page: int = 1, page_size: int = 10):
    """
    Fetches products from the API based on the given query and filters.
    """
    logging.info(f"Fetching products with query: {query}, category: {category}, min_price: {min_price}, max_price: {max_price}, page: {page}, page_size: {page_size}")
    
    url = f"{API_BASE_URL}/products"
    params = {"q": query, "page": page, "page_size": page_size}
    
    if category:
        params["category"] = category
    if min_price is not None:
        params["min_price"] = min_price
    if max_price is not None:
        params["max_price"] = max_price
    
    try:
        response = requests.get(url, params=params)
        response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)
        products = response.json()
        logging.info(f"Successfully fetched products. Response status code: {response.status_code}, Number of products: {len(products)}")
        return products
    except requests.exceptions.RequestException as e:
        logging.error(f"Error fetching products: {e}")
        st.error(f"An error occurred while fetching products: {e}")
        return []
    except json.JSONDecodeError as e:
        logging.error(f"Error decoding JSON response: {e}, Response text: {response.text if 'response' in locals() else 'No response'}") # Log response text if available
        st.error(f"An error occurred while decoding the server response. Please check the server logs.")
        return []
    except Exception as e:
        logging.exception(f"An unexpected error occurred: {e}") # Use exception for full traceback
        st.error(f"An unexpected error occurred: {e}")
        return []
```

Key improvements and explanations:

* **Import `logging`:**  Critically important, the code now imports the `logging` module.
* **`logging.basicConfig`:**  This is essential to configure the logging system.  I've added a basic configuration that outputs log messages to the console at the `INFO` level.  You can customize the `level` (e.g., `DEBUG`, `WARNING`, `ERROR`) and `format` as needed.  This should generally be done *once* at the beginning of your script.
* **Logging at different levels:** The code now uses `logging.info`, `logging.error`, and `logging.exception`.  `logging.info` is used for normal operational information.  `logging.error` is used for recoverable errors.  `logging.exception` is very important; it logs the error message *and* the full traceback, which is invaluable for debugging.  Use it in `except` blocks to capture the full context of the error.
* **Detailed logging messages:** The log messages are now more informative.  They include the query parameters, the response status code, and the number of products returned.  This makes it much easier to diagnose problems.
* **Error handling:** The code now includes more robust error handling, including handling `requests.exceptions.RequestException` (for network errors) and `json.JSONDecodeError` (for errors decoding the server's response).  Critically, it logs the *response text* when a JSON decoding error occurs, which can help you understand what the server is sending back.
* **Handles missing response:** Includes a check to see if the `response` variable exists before trying to access its `text` attribute in the `JSONDecodeError` handler.  This avoids a potential `NameError` if the request fails before a response object is created.
* **`try...except` block:**  The function is wrapped in a `try...except` block to catch potential exceptions during the API call. This prevents the entire application from crashing.
* **Clear Error Messages to the User**: In addition to logging the errors, informative error messages are displayed to the user using `st.error()`.  This is important for a good user experience.
* **Using `logging.exception`:** Changed the generic `except Exception as e:` to use `logging.exception(f"An unexpected error occurred: {e}")`.  This logs the full traceback, which is extremely helpful for debugging unexpected errors.

This improved version provides much better logging and error handling, making it easier to debug and maintain your Streamlit application. Remember to adjust the `logging.basicConfig` settings to suit your specific needs.  Consider logging to a file in a production environment.

---
*Generated by Smart AI Bot*
