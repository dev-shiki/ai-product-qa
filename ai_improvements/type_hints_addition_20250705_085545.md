# Type Hints Addition

**File**: `./app/services/ai_service.py`  
**Time**: 08:55:45  
**Type**: type_hints_addition

## Improvement

```python
import logging
from google import genai
from app.utils.config import get_settings
from app.services.product_data_service import ProductDataService

# Setup logging
logger = logging.getLogger(__name__)

class AIService:
    def __init__(self):
        """Initialize AI service with Google AI API"""
        try:
            settings = get_settings()
            # Use the new Google AI client
            self.client = genai.Client(api_key=settings.GOOGLE_API_KEY)
            self.product_service = ProductDataService()
            logger.info("Successfully initialized AI service with Google AI client")
        except Exception as e:
            logger.error(f"Error initializing AI service: {str(e)}")
            raise

    async def get_response(self, question: str) -> str:
        """Get AI response with product context and fallback message"""
        try:
            logger.info(f"Getting AI response for question: {question}")

            # Ekstrak kategori dan max_price dari pertanyaan (sederhana)
            import re
            category = None
            max_price = None
            
            # Deteksi kategori dengan lebih lengkap (sama dengan API endpoint)
            question_lower = question.lower()
            category_mapping = {
                'laptop': ['laptop', 'notebook', 'komputer'],
                'smartphone': ['smartphone', 'hp', 'handphone', 'phone', 'telepon', 'ponsel'],
                'tablet': ['tablet', 'ipad'],
                'headphone': ['headphone', 'earphone', 'headset', 'audio'],
                'kamera': ['kamera', 'camera', 'fotografi'],
                'audio': ['audio', 'speaker', 'sound'],
                'tv': ['tv', 'televisi'],
                'drone': ['drone', 'quadcopter'],
                'jam': ['jam', 'watch', 'smartwatch']
            }
            
            for cat, keywords in category_mapping.items():
                if any(keyword in question_lower for keyword in keywords):
                    category = cat
                    break
            
            # Cari angka (harga) dalam pertanyaan
            price_match = re.search(r'\d+(?:\.\d+)?', question)
            if price_match:
                try:
                    max_price = float(price_match.group(0))
                except ValueError:
                    logger.warning(f"Could not convert price to float: {price_match.group(0)}")
                    max_price = None

            # Dapatkan konteks produk dari service
            products = await self.product_service.get_products(category=category, max_price=max_price)

            # Susun konteks untuk AI
            if products:
                product_context = "\n".join([f"{p.name}: {p.description} (Harga: {p.price})" for p in products])
                prompt = f"Anda adalah asisten toko online. Jawab pertanyaan pengguna berdasarkan konteks produk berikut:\n\n{product_context}\n\nPertanyaan: {question}"
            else:
                prompt = f"Jawab pertanyaan pengguna tentang toko online. Tidak ada informasi produk yang tersedia.\n\nPertanyaan: {question}"


            # Kirim pertanyaan ke Google AI
            model = self.client.models.get("gemini-1.5-pro-latest") # was "gemini-1.0-pro"
            response = model.generate_content(prompt)
            
            logger.info(f"AI response: {response.text}")
            return response.text

        except Exception as e:
            logger.error(f"Error getting AI response: {str(e)}")
            return "Maaf, saya tidak dapat menjawab pertanyaan ini saat ini."
```

---
*Generated by Smart AI Bot*
